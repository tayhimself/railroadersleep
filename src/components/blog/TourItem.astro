---
import { Picture } from "@astrojs/image/components";
import { getPermalink } from "~/utils/permalinks";
import { findImage } from "~/utils/images";

const { post } = Astro.props;

const image = await findImage(post.image);
---
<div class="card grid grid-cols-2 grid-rows-1 gap-2 md:gap-4 bg-base-200 rounded-xl shadow-xl">
  <label for={post.slug} class="relative cursor-pointer">

    <div class="overflow-hidden">
      {
        image && (
          <Picture
            src={image}
            class="absolute inset-0 object-cover object-center h-full mb-6 rounded-l-xl"
            widths={[400, 900]}
            sizes="(max-width: 900px) 400px, 900px"
            aspectRatio={post.image_aspect_ratio || null}
            alt={post.title}
          />
        )
      }
      {
        !image && post.video_url && (
          <div class=" mb-6 rounded h-full w-full">
            <div class="aspect-w-16 aspect-h-9">
              <iframe
                class="absolute w-full h-full"
                src={post.video_url}
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              />
            </div>
          </div>
        )
      }
    </div>
  </label>
  <div class="p-2 lg:p-4">
    <header>
      <h2 class="text-lg sm:text-xl font-bold leading-snug mb-2 font-heading">
        <a
          class="hover:text-primary-focus  runderline underline-offset-4 decoration-1 decoration-dotted transition ease-in duration-200"
          href={getPermalink(post.slug, "post")}>
          {post.title}
        </a>
      </h2>
    </header>
    <label for={post.slug} class="cursor-pointer">
    {
      !post.video_title && !post.video_description && (
        <p class="text-sm sm:text-md flex-grow">{post.excerpt || post.description.substring(0, 120)}...</p>
      )
    }
    {post.video_description && <p class="text-sm sm:text-md flex-grow">{post.description}</p>}
    <footer class="mt-2">
      <div>
        <span class="text-sm text-opacity-70">
          ~ {Math.ceil(post.readingTime)} min read
        </span>
      </div>
    </footer>
  </label>
  </div>
</div>
